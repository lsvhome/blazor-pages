<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width">
    <title>Encrypted Google Drive</title>
    <base href="/" />


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.bundle.min.js" integrity="sha384-zDnhMsjVZfS3hiP7oCBRmfjkQC4fzxVxFhBx8Hkz2aZX8gEvA/jsP3eXRCvzTofP" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

    <link href="css/site.css" rel="stylesheet" />














</head>
<body>
    <app>
        <div class="d-flex justify-content-center center-div">
            <div class="spinner-border" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
    </app>

    <script src="_framework/blazor.webassembly.js"></script>
    <script src="jsInterop.js"></script>

    <script>

        function login(url001, redirecturl) {

            var result;
            var promise = new Promise(function (resolve, reject) {
                //debugger;
                var win = window.open(url001, "windowname1", 'width=800, height=800');

                var pollTimer = window.setInterval(function () {
                    //console.log("pollTimer");
                    try {

                        if (true == win.closed && result == undefined) {
                            //console.log("clearInterval 1");
                            result = false;
                            window.clearInterval(pollTimer);
                            reject();
                            return;
                        }

                        var url = "";
                        try {
                            url = win.document.URL;
                        } catch (e) {
                            // there we may got security error (CORs?)
                            return;
                        }

                        if (url.indexOf(redirecturl) != -1) {
                            //console.log("clearInterval 2");
                            window.clearInterval(pollTimer);
                            var acCode = gup(url, 'code');
                            result = true;
                            win.close();

                            resolve(acCode);
                        }
                    } catch (e) {
                        result = false;
                        reject(e);
                    }
                }, 300);
            });

            return promise;
        }

        //credits: http://www.netlobo.com/url_query_string_javascript.html
        function gup(url, name) {
            //console.log("gup1 " + url);
            //console.log("gup2 " + name);
            name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
            //console.log("gup3 " + name);
            var regexS = "[\\#&\?]" + name + "=([^&]*)";
            //console.log("gup4 " + regexS);
            var regex = new RegExp(regexS);
            var results = regex.exec(url);
            //console.log("gup5 " + results);
            if (results == null) {
                //console.log("gup7 ");
                return "";
            }
            else {
                console.log("gup6 " + results[1]);
                return results[1];
            }
        }


        function saveAsFile(filename, bytesBase64) {
            //console.log("saveAsFile 001 " +filename);
            console.log(bytesBase64.length);
            var link = document.createElement('a');
            link.download = filename;
            link.href = "data:application/octet-stream;base64," + bytesBase64;
            document.body.appendChild(link); // Needed for Firefox
            link.click();
            //console.log("saveAsFile 002 " + filename);
            document.body.removeChild(link);
            //console.log("saveAsFile 003 " + filename);
        }
        /*
        function loadFile001(inputFile) {
            console.log(inputFile + " 001");
            //debugger;
            const temporaryFileReader = new FileReader();
            console.log(temporaryFileReader);
            //temporaryFileReader.

            var tt = document.getElementById(inputFile);

            var promise = new Promise((resolve, reject) => {
                console.log(inputFile + " 002");
                try {

                    temporaryFileReader.onerror = () => {
                        console.log("rejected");
                        temporaryFileReader.abort();
                        reject(new DOMException("Problem parsing input file."));
                    };
                    temporaryFileReader.addEventListener("load", function () {
                        console.log("onload");
                        //debugger;
                        var data = {
                            name: tt.files[0].name,
                            content: temporaryFileReader.result.split(',')[1]
                        };
                        console.log(data);
                        
                        resolve(data);
                    }, false);

                    console.log(" 001-1 " + tt);

                    console.log("AAA " + tt.files[0]);
                    temporaryFileReader.readAsDataURL(tt.files[0]);
                    
                    console.log("BBB");
                } catch (e) {
                    console.log("ERROR 9845629348");
                    console.log(e);
                }

            });

            return promise;
        };
        */
    </script>
</body>
</html>
